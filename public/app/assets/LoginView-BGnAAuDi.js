import{d as q,g as B,h as g,c as D,a as t,i as w,v as y,u,j as F,t as L,e as p,w as c,k as $,l as _,m,b as V,o as j,f}from"./index-BLDBbRsw.js";import{r as b}from"./request-DfzbtKw4.js";const A={class:"login"},K={class:"form"},M={class:"opt"},O={class:"opt"},P={class:"opt opt-2"},z={class:"opt"},G={class:"opt opt-3"},H={class:"bottom"},X=q({__name:"LoginView",setup(J){const k=$(),x=()=>{k.push({path:"/home/category"})};let o=B({account:"",password:""}),d=g(""),r=g("发送邮箱验证码"),i=g(60),v=!0,N=null;const C=()=>{i.value--,r.value=`${i.value}秒后重新发送`,N=setInterval(()=>{i.value--,r.value=`${i.value}秒后重新发送`,i.value==0&&(clearInterval(N),r.value="点击重新发送",v=!0,i.value=60)},1e3)},h=async()=>{let l=o.account;l.length!=0?/\w+@qq.com$/.test(l)?v&&(v=!1,C(),await b.emailSend({email:l}).then(e=>{let{msg:a}=e;_(a)})):_("邮箱格式不正确"):m("请输入账号")},I=async()=>{let l=o.account,e=d.value;if(l.length==0||e.length==0)m("输入框不能为空");else{let a=!1;if(await b.emailVerify({email:l,vcode:e}).then(n=>{let{code:s}=n;s==200&&(a=!0)}),a){let{account:n,password:s}=o;n&&s?await b.login({account:n,password:s}).then(S=>{let{code:E,msg:T,nickName:R,token:U}=S;localStorage.setItem("AUTOTOKEN",U),localStorage.setItem("NICKNAME",R),E==200?(_(T),setTimeout(()=>{k.replace({path:"/my"})},150)):m(T)}):m("缺少参数,请检查再提交")}}};return(l,e)=>{const a=V("van-button"),n=V("RouterLink");return j(),D("div",A,[t("div",K,[e[9]||(e[9]=t("h4",null,"用户登录",-1)),t("div",M,[e[3]||(e[3]=t("span",{class:"label"},"账号:",-1)),w(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>u(o).account=s),type:"text",placeholder:"请输入账号/邮箱"},null,512),[[y,u(o).account]])]),t("div",O,[e[4]||(e[4]=t("span",{class:"label"},"密码:",-1)),w(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>u(o).password=s),type:"password",placeholder:"请输入密码"},null,512),[[y,u(o).password]])]),t("div",P,[e[5]||(e[5]=t("span",{class:"label"},"验证码:",-1)),w(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>F(d)?d.value=s:d=s),type:"text",placeholder:"请输入密码"},null,512),[[y,u(d)]]),t("button",{onClick:h,class:"btn-send"},L(u(r)),1)]),t("div",z,[p(a,{onClick:I,class:"btn-login",type:"default"},{default:c(()=>e[6]||(e[6]=[f("登录")])),_:1})]),t("div",G,[p(n,{to:"/register"},{default:c(()=>e[7]||(e[7]=[f("免费注册")])),_:1}),p(n,{to:"/findpwd"},{default:c(()=>e[8]||(e[8]=[f("忘记密码?")])),_:1})])]),t("div",H,[p(a,{onClick:x,type:"default",plain:"",color:"#cccccc"},{default:c(()=>e[10]||(e[10]=[f("首页")])),_:1})])])}}});export{X as default};
