import{d as N,r as k,aG as E,o as M,c as U,a as e,b as n,w as _,ae as g,af as h,u as i,aa as T,bV as $,ab as m,I as B,e as L}from"./index-BU7Eo9xm.js";import{t as S,s as K}from"./request-DCHLsrwf.js";import{E as v}from"./index-CZzwatfY.js";const P={class:"login"},R={class:"form"},A={class:"opt"},D={class:"label"},F={class:"inpbox"},G={class:"opt"},O={class:"label"},j={class:"inpbox"},q={class:"opt"},z={class:"label"},H={class:"inpbox"},J={class:"opt"},Z=N({__name:"LoginView",setup(Q){let w=k(),r,d=100,p=40,y=T.url,a=k({account:"",password:"",captcha:""});const x=$(),I=async()=>{let{account:t,password:s,captcha:u}=a.value;if(t&&s&&u){let c;await S({captcha:u}).then(o=>{o.code==200?c=!0:v({type:"error",message:o.msg})}),c&&await K({account:t,password:s,role:1}).then(o=>{let{code:f,msg:b}=o;if(f==200){let{nickName:l,token:C}=o;localStorage.setItem("NICK_NAME",l),localStorage.setItem("TOKEN",C),v({type:"success",message:o.msg}),setTimeout(()=>{x.replace({path:"/"})},150)}else v({type:"error",message:o.msg})})}else v({type:"error",message:"输入框不能为空"})};E(()=>{let t=w.value,s=new Image;s.src=`${y}/api/verify/captcha`,t&&(t.width=d,t.height=p,r=t.getContext("2d"),s.onload=()=>{r.drawImage(s,0,0,d,p)})});const V=()=>{let t=new Image;t.src=`${y}/api/verify/captcha?${Math.random()}`,r.clearRect(0,0,d,p),t.onload=()=>{r.drawImage(t,0,0,d,p)}};return(t,s)=>{const u=m("User"),c=B,o=m("Lock"),f=m("Picture"),b=m("router-link");return M(),U("div",P,[e("div",R,[s[4]||(s[4]=e("div",{class:"title"},[e("span",null,"管理员登录")],-1)),e("div",A,[e("div",D,[n(c,null,{default:_(()=>[n(u)]),_:1})]),e("div",F,[g(e("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=l=>i(a).account=l),placeholder:"请输入账号/邮箱"},null,512),[[h,i(a).account]])])]),e("div",G,[e("div",O,[n(c,null,{default:_(()=>[n(o)]),_:1})]),e("div",j,[g(e("input",{type:"password","onUpdate:modelValue":s[1]||(s[1]=l=>i(a).password=l),placeholder:"请输入密码"},null,512),[[h,i(a).password]])])]),e("div",q,[e("div",z,[n(c,null,{default:_(()=>[n(f)]),_:1})]),e("div",H,[g(e("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=l=>i(a).captcha=l),placeholder:"请输入验证码"},null,512),[[h,i(a).captcha]])]),e("div",{class:"vcode",onClick:V},[e("canvas",{ref_key:"canvas",ref:w},null,512)])]),e("div",J,[n(b,{to:"/findpwd"},{default:_(()=>s[3]||(s[3]=[L("忘记密码?")])),_:1})]),e("div",{class:"opt"},[e("button",{class:"btn",onClick:I},"登录")])])])}}});export{Z as default};
