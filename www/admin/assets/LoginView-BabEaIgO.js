import{a as N,j as k,k as E,o as M,c as U,g as e,m as n,p as m,C as f,D as h,e as c,q as T,bW as $,s as _,x as B,i as L}from"./index-PsrkDi4f.js";import{x as S,y as D}from"./request-aijzG6J_.js";import{E as v}from"./index-2NzJ_tzg.js";const K={class:"login"},P={class:"form"},R={class:"opt"},j={class:"label"},q={class:"inpbox"},A={class:"opt"},F={class:"label"},O={class:"inpbox"},W={class:"opt"},z={class:"label"},G={class:"inpbox"},H={class:"opt"},Z=N({__name:"LoginView",setup(J){let w=k(),r,d=100,p=40,x=T.url,a=k({account:"",password:"",captcha:""});const b=$(),C=async()=>{let{account:t,password:s,captcha:u}=a.value;if(t&&s&&u){let i;await S({captcha:u}).then(o=>{o.code==200?i=!0:v({type:"error",message:o.msg})}),i&&await D({account:t,password:s,role:1}).then(o=>{let{code:g,msg:y}=o;if(g==200){let{nickName:l,token:V}=o;localStorage.setItem("NICK_NAME",l),localStorage.setItem("TOKEN",V),v({type:"success",message:o.msg}),setTimeout(()=>{b.replace({path:"/"})},150)}else v({type:"error",message:o.msg})})}else v({type:"error",message:"输入框不能为空"})};E(()=>{let t=w.value,s=new Image;s.src=`${x}/api/verify/captcha`,t&&(t.width=d,t.height=p,r=t.getContext("2d"),s.onload=()=>{r.drawImage(s,0,0,d,p)})});const I=()=>{let t=new Image;t.src=`${x}/api/verify/captcha?${Math.random()}`,r.clearRect(0,0,d,p),t.onload=()=>{r.drawImage(t,0,0,d,p)}};return(t,s)=>{const u=_("User"),i=B,o=_("Lock"),g=_("Picture"),y=_("router-link");return M(),U("div",K,[e("div",P,[s[4]||(s[4]=e("div",{class:"title"},[e("span",null,"管理员登录")],-1)),e("div",R,[e("div",j,[n(i,null,{default:m(()=>[n(u)]),_:1})]),e("div",q,[f(e("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=l=>c(a).account=l),placeholder:"请输入账号/邮箱"},null,512),[[h,c(a).account]])])]),e("div",A,[e("div",F,[n(i,null,{default:m(()=>[n(o)]),_:1})]),e("div",O,[f(e("input",{type:"password","onUpdate:modelValue":s[1]||(s[1]=l=>c(a).password=l),placeholder:"请输入密码"},null,512),[[h,c(a).password]])])]),e("div",W,[e("div",z,[n(i,null,{default:m(()=>[n(g)]),_:1})]),e("div",G,[f(e("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=l=>c(a).captcha=l),placeholder:"请输入验证码"},null,512),[[h,c(a).captcha]])]),e("div",{class:"vcode",onClick:I},[e("canvas",{ref_key:"canvas",ref:w},null,512)])]),e("div",H,[n(y,{to:"/findpwd"},{default:m(()=>s[3]||(s[3]=[L("忘记密码?")])),_:1})]),e("div",{class:"opt"},[e("button",{class:"btn",onClick:C},"登录")])])])}}});export{Z as default};
