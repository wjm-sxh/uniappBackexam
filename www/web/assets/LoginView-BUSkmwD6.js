import{d as q,h as B,r as y,c as D,a as t,i as _,v as b,u,j as F,t as L,b as p,w as c,k as $,l as m,m as f,f as x,o as j,g as v}from"./index-BxMPK5Cm.js";import{r as k}from"./request-Ci6WhDJZ.js";const A={class:"login"},K={class:"form"},M={class:"opt"},O={class:"opt"},P={class:"opt opt-2"},z={class:"opt"},G={class:"opt opt-3"},H={class:"bottom"},X=q({__name:"LoginView",setup(J){const N=$(),C=()=>{N.push({path:"/home/category"})};let o=B({account:"",password:""}),d=y(""),r=y("发送邮箱验证码"),i=y(60),g=!0,T=null;const h=()=>{i.value--,r.value=`${i.value}秒后重新发送`,T=setInterval(()=>{i.value--,r.value=`${i.value}秒后重新发送`,i.value==0&&(clearInterval(T),r.value="点击重新发送",g=!0,i.value=60)},1e3)},I=async()=>{let l=o.account;l.length!=0?/\w+@qq.com$/.test(l)?g&&(g=!1,h(),await k.emailSend({email:l}).then(e=>{let{msg:a}=e;m(a)})):m("邮箱格式不正确"):f("请输入账号")},S=async()=>{let l=o.account,e=d.value;if(l.length==0||e.length==0)f("输入框不能为空");else{let a=!1;if(await k.emailVerify({email:l,vcode:e}).then(n=>{let{code:s,msg:w}=n;s==200?a=!0:m(w)}),a){let{account:n,password:s}=o;n&&s?await k.login({account:n,password:s}).then(w=>{let{code:E,msg:V,nickName:R,token:U}=w;localStorage.setItem("AUTOTOKEN",U),localStorage.setItem("NICKNAME",R),E==200?(m(V),setTimeout(()=>{N.replace({path:"/my"})},150)):f(V)}):f("缺少参数,请检查再提交")}}};return(l,e)=>{const a=x("van-button"),n=x("RouterLink");return j(),D("div",A,[t("div",K,[e[9]||(e[9]=t("h4",null,"用户登录",-1)),t("div",M,[e[3]||(e[3]=t("span",{class:"label"},"账号:",-1)),_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>u(o).account=s),type:"text",placeholder:"请输入账号/邮箱"},null,512),[[b,u(o).account]])]),t("div",O,[e[4]||(e[4]=t("span",{class:"label"},"密码:",-1)),_(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>u(o).password=s),type:"password",placeholder:"请输入密码"},null,512),[[b,u(o).password]])]),t("div",P,[e[5]||(e[5]=t("span",{class:"label"},"验证码:",-1)),_(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>F(d)?d.value=s:d=s),type:"text",placeholder:"请输入密码"},null,512),[[b,u(d)]]),t("button",{onClick:I,class:"btn-send"},L(u(r)),1)]),t("div",z,[p(a,{onClick:S,class:"btn-login",type:"default"},{default:c(()=>e[6]||(e[6]=[v("登录")])),_:1})]),t("div",G,[p(n,{to:"/register"},{default:c(()=>e[7]||(e[7]=[v("免费注册")])),_:1}),p(n,{to:"/findpwd"},{default:c(()=>e[8]||(e[8]=[v("忘记密码?")])),_:1})])]),t("div",H,[p(a,{onClick:C,type:"default",plain:"",color:"#cccccc"},{default:c(()=>e[10]||(e[10]=[v("首页")])),_:1})])])}}});export{X as default};
