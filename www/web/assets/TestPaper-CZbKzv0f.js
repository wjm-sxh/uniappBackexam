import{d as U,r as g,c as d,a as o,g as v,t as i,u,F as b,e as q,q as j,b as k,w,k as G,x as H,m as I,l as Q,f as W,o as f,n as A}from"./index-BxMPK5Cm.js";import{r as E}from"./request-Ci6WhDJZ.js";const X={class:"test-paper"},Y={class:"test-top"},Z={class:"title"},ee={class:"message"},te={class:"num"},se={class:"test-content"},le={key:0,class:"item"},ae={class:"q"},oe=["onClick"],ne={class:"test-footer"},re={class:"left"},ie={class:"right"},ue={class:"test-show-box"},ce=["onClick"],pe=U({__name:"TestPaper",setup(ve){const O=G(),z=H();let{eid:y,name:S,time:h}=z.query,p=g(0),r=g([]),N=null,l=g(0),c=g({}),x=g(0),m=localStorage.getItem("AUTOTOKEN"),C=[];h&&(p.value=h*60*60,N=setInterval(()=>{p.value--,p.value==0&&clearInterval(N)},1e3));const M=a=>{let e=0,t=0,s=0;return e=Math.floor(a/3600),t=Math.floor(a%3600/60),s=Math.floor(a%60),e=e<10?"0"+e:e,t=t<10?"0"+t:t,s=s<10?"0"+s:s,`${e}:${t}:${s}`},V=async()=>{y&&await E.topicList({eid:y}).then(a=>{console.log(a);let{code:e,msg:t,result:s}=a;if(e==200){let n=s.map(_=>(_.opt=JSON.parse(_.opt),_));r.value=n,x.value=n.length,c.value=n[l.value]}else I(t)})},B=(a,e)=>{if(!m)return!1;c.value.opt.forEach(t=>{t.isSelect=void 0}),c.value.opt[e].isSelect=!0,r.value[l.value].opt[e].isSelect=!0,r.value[l.value].isSelect=!0,C[l.value]=a},D=a=>{l.value=a},J=()=>{if(!m)return!1;if(l.value++,l.value>r.value.length-1)return l.value=r.value.length-1,!1;c.value=r.value[l.value]},K=()=>{if(!m)return!1;if(l.value--,l.value<0)return l.value=0,!1;c.value=r.value[l.value]};let T=0,F=0,$=0,L=localStorage.getItem("NICKNAME"),P=localStorage.getItem("ACCOUNT");const R=async()=>{if(!m)return!1;let a=r.value;for(let t=0;t<a.length;t++)a[t].answer==C[t]?(T+=a[t].score,$++):F++;let e=JSON.stringify(C);console.log("我的答案:",e),await E.examScoreAdd({token:m,nickName:L,account:P,name:S,score:T,wrong:F,right:$,myanswer:e,time:h*60*60-p.value}).then(t=>{let{code:s,msg:n}=t;console.log(t),s==200?(Q(n),setTimeout(()=>{O.replace({path:"/score"})},300)):I(n)})};return V(),(a,e)=>{const t=W("van-button");return f(),d("div",X,[o("div",Y,[o("h4",Z,[e[0]||(e[0]=v("名称: ")),o("span",null,i(u(S)),1)]),o("p",ee,"距离考试结束 "+i(M(u(p))),1),o("div",te,[e[1]||(e[1]=v("【")),o("span",null,i(u(x)),1),e[2]||(e[2]=v("/ ")),o("span",null,i(u(l)),1),e[3]||(e[3]=v("】"))])]),o("div",se,[u(c)?(f(),d("div",le,[o("div",ae,i(u(l)+1)+"."+i(u(c).question),1),o("ul",null,[(f(!0),d(b,null,q(u(c).opt,(s,n)=>(f(),d("li",{class:A(s.isSelect==!0?"active":""),onClick:_=>B(s.key,n)},i(s.key)+"."+i(s.value),11,oe))),256))])])):j("",!0)]),o("div",ne,[o("div",re,[k(t,{onClick:K,plain:"",hairline:"",type:"primary",size:"small"},{default:w(()=>e[4]||(e[4]=[v("上一题")])),_:1}),k(t,{onClick:J,plain:"",hairline:"",type:"success",size:"small"},{default:w(()=>e[5]||(e[5]=[v("下一题")])),_:1})]),o("div",ie,[k(t,{type:"danger",onClick:R,size:"small"},{default:w(()=>e[6]||(e[6]=[v("提交试卷")])),_:1})])]),o("div",ue,[o("ol",null,[(f(!0),d(b,null,q(u(r),(s,n)=>(f(),d("li",{class:A(s.isSelect==!0?"active":""),onClick:_=>D(n)},i(n+1),11,ce))),256))])])])}}});export{pe as default};
